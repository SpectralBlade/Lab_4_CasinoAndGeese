# Лабораторная работа №4. Симуляция с пользовательсĸими ĸоллеĸциями и псевдослучайной моделью

## Введение. Объектно-ориентированный кисель: казино с гусями
Выбранный вариант лабораторной работы - второй.

Добро пожаловать в лучший игорный дом Лас-Вегаса!

Вечер пятницы настал, ночной покров опустился на улицы, которые быстро стали пустынными. Встреча шла по плану. Студенты МАИ, как нынешние, так и уже выпускники, собрались здесь сегодня на долгую, комфортную игровую сессию. В приятной компании знакомых, за выпивкой и закусками, все игроки получают удовольствие... Кто-то, ослепленный лудоманией, бесконечно крутит слоты в попытках выбить три семерки, кто-то сидит за столом, раскидывая дружеский покер. Остальные просто наслаждаются приятным вечером. Но никто даже не подозревал, что на заднем дворе злобные гуси готовят свой план мести людишкам... Будучи преследуемыми везде и всегда, рискующие каждую минуту своей жизни оказаться приготовленными на ужин, пернатые с острыми клювами устали терпеть постоянные унижения от жадных лудоманов. Они точат клювы и разогревают голосовые связки, настраивая себя. Скоро в теплой маевской атмосфере будет посеян хаос...

Симуляция выполнена в неконтролируемом формате - пользователь может лишь запустить ее, введя необходимые параметры, и наблюдать за получившимся игровым миром.

## Структура проекта

 <pre>
    ├── Lab_4_CasinoAndGeese                   # Кодовая база лабораторной работы №4
    │   ├── src/                               # Исходный код
    │   │   ├── classes/                       # Основные игровые сущности
    │   │   │   ├── __init__.py
    │   │   │   ├── casino.py                  # Основная логика казино и случайных событий
    │   │   │   ├── goose.py                   # Классы гусей, подклассы (лечебный-военный-крикливый)
    │   │   │   └── player.py                  # Класс игрока
    │   │   │
    │   │   ├── custom_collections/            # Пользовательские коллекции
    │   │   │   ├── __init__.py
    │   │   │   ├── casino_collection.py       # Коллекция балансов казино
    │   │   │   ├── goose_collection.py        # Коллекция гусей
    │   │   │   └── player_collection.py       # Коллекция игроков
    │   │   │
    │   │   ├── __init__.py
    │   │   ├── create_simulation.py           # Создание и настройка симуляции
    │   │   ├── func_to_goose.py               # Сопоставление команд типам гусей
    │   │   ├── logger.py                      # Логгер игровых событий
    │   │   ├── logging_config.py              # Конфигурация логирования
    │   │   ├── main.py                        # Точка входа в программу
    │   │   ├── name_choices.py                # Варианты имён игроков и гусей
    │   │   └── games_history.log              # Лог истории игр
    │   │
    │   ├── tests/                             # Тесты
    │   │   ├── __init__.py
    │   │   ├── conftest.py                    # Общие фикстуры pytest
    │   │   ├── test_casino_core.py            # Тесты базовой логики казино
    │   │   ├── test_casino_events.py          # Тесты игровых событий
    │   │   ├── test_collections.py            # Тесты пользовательских коллекций
    │   │   ├── test_goose.py                  # Тесты классов гусей
    │   │   ├── test_player.py                 # Тесты класса игрока
    │   │   └── test_random_events.py          # Тесты случайных событий
    │   │
    │   ├── .coveragerc                        # Конфигурация coverage (игнорирование main и create_simulation)
    │   ├── .gitignore                         # git ignore файл
    │   ├── .pre-commit-config.yaml            # Средства автоматизации проверки кодстайла
    │   ├── pytest.ini                         # Настройки pytest
    │   ├── pyproject.toml                     # Конфигурация проекта
    │   ├── uv.lock                            # Зависимости проекта
    │   └── README.md                          # Описание проекта
</pre>

## Принцип работы
Пользователь запускает симуляцию через main.py, вводит желаемое количество гусей и игроков, затем seed (либо оставляет пустой для случайного), после чего вводит количество шагов, время (скорость проигрыша симуляции пошагово) и игровой мир создается. Симуляция играет на протяжении заданного количества шагов, воспроизводя случайное событие на каждом шаге. Если игра закончилась раньше, чем за требуемое количество шагов - пользователю выводится сообщение о победившей команде и список ее участников.

## Инициализируемые сущности в начале игры
1. Игрок (Player) - имеет имя, возраст, начальный баланс и кредитную историю.
2. Гусь (Goose) - имеет имя, тип (дает особые способности), очки здоровья (в зависимости от типа), начальную силу (случайна, от 250 до 500)

## Что реализовано как "случайные события"?
- стандартная атака гуся (сила, умноженная на некоторый коэффициент). Отнимает у игрока количество денег, равное итоговой силе атаки. Может быть провалена (если сработает шанс уклонения игрока), в таком случае гусь потеряет 30% своего здоровья.
- громкий крик гуся. Особая способность только для типа "Крикливый". Игнорирует шансы уклонения, заставляет всех игроков в панике выронить количество денег, равное силе гуся.
- жёсткий укус гуся. Особая способность только для типа "Военный". Игнорирует шанс уклонения игрока, ворует у него количество денег, равное силе гуся * 7.
- магическое лечение гуся. Особая способность только для типа "Лечебный". Восстанавливает другому гусю количество здоровья, равное силе гуся-доктора.
- ставка игрока в слотах казино. Игрок ставит случайное число денег (от минимальной ставки в 200$ до 2/3 от своего баланса). Есть несколько исходов - начиная от полного проигрыша ставки до куша х100.
- поход игрока в подвальную качалку. Там он тратит определенное количество денег и накачивает мускулы, тем самым повышая шанс избежания гусиной атаки.
- поход игрока на гаражные соревнования по боксу. Участвуя в любительских поединках за небольшую сумму, он наращивает силу как физической атаки, так и моральной ярости (в будущем они могут быть направлены против обнаглевших гусей).
- взятие игроком кредита. Если он подходит под условия (кредитная история чиста - >= 2 кредитов, баланс нулевой (или меньше минимальной ставки при попытке поставить)), то банк выдает ему 15000$. В кредитную историю добавляется пятнышко.
- принудительное отбирание у игрока суммы кредита. К изначальным средствам накручивается 20% годовых, и, если у игрока есть кредит и 20000$ на балансе, банк их забирает.
- атака игроком гуся. Когда пернатый уже достал кусать за ноги и воровать деньги, игрок прогоняет гуся, нанося ему урон (зависит от кол-ва проведенных поединков по боксу. По умолчанию урон 400)
- приход игрокам степухи. Каждому начисляется на баланс 5000$.
- кровавая луна. Сила гусей (лечение/тяжелая атака/крик) умножается на некоторый коэффициент (1.2-1.4).
- появление в игре нового игрока/гуся. Создается с начальными минимальными параметрами (не скейлятся от текущих значений участников, выбираются так же рандомно)

## Как вычисляется результат игры?
В процессе симуляции ее участники могут выбывать.
Игроки: если у них нулевой баланс и грязная кредитная история (три невыплаченных). Коллекторы выводят игрока из игорного дома и ссылают в лес @mrsskaa.
Гуси: если их здоровье на нуле. Слабых гусей в казино долго не держат - жарят на вертеле и подают на стол игрокам.

## Допущения и чуть тарабарщины
По тестам - покрытие 87%. Исключил main и create_simulation, дабы тестировать лишь непосредственно игровую логику.

После нескольких десятков прогонов выяснилось, что шанс победы команды гусей и игроков одинаков. По подсчетам, игроки побеждают на ~900 ходу. Если этого не произошло, то произойдет победа гусей на ~1600-1700 ходу.

Ходы выводятся пользователю в консоль, параллельно логируясь в файл src/games_history.log. Между симуляциями файл не очищается.

Рядом с каждым ходом выводится его номер вида [Ход ...]. Если ход не удался (такое возможно в рамках симуляции - не забрался кредит у игрока или он не смог потрениться в качалочке) - номер хода пропускается (считается, что игрок пропустил свой ход).

За кредитом игрока посылают пинками в двух случаях: 
1. Если ограбили догола гуси
2. Если выяснилось, что слишком мало денег при попытке додепать в казино

## В остальном все! Удачного пользования симуляцией! 
Пожелания и предложения - в issue (в планах было дополнение казика и введение интерактивного режима, но на данный момент я решил оставить только симуляцию)

